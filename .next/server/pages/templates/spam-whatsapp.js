"use strict";(()=>{var e={};e.id=0,e.ids=[0,660],e.modules={79758:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{config:()=>b,default:()=>u,getServerSideProps:()=>h,getStaticPaths:()=>p,getStaticProps:()=>x,reportWebVitals:()=>g,routeModule:()=>y,unstable_getServerProps:()=>N,unstable_getServerSideProps:()=>z,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>f,unstable_getStaticProps:()=>j});var r=s(87093),n=s(35244),l=s(1323),i=s(61682),o=s.n(i),d=s(81763),c=s(86697),m=e([c]);c=(m.then?(await m)():m)[0];let u=(0,l.l)(c,"default"),x=(0,l.l)(c,"getStaticProps"),p=(0,l.l)(c,"getStaticPaths"),h=(0,l.l)(c,"getServerSideProps"),b=(0,l.l)(c,"config"),g=(0,l.l)(c,"reportWebVitals"),j=(0,l.l)(c,"unstable_getStaticProps"),f=(0,l.l)(c,"unstable_getStaticPaths"),v=(0,l.l)(c,"unstable_getStaticParams"),N=(0,l.l)(c,"unstable_getServerProps"),z=(0,l.l)(c,"unstable_getServerSideProps"),y=new r.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/templates/spam-whatsapp",pathname:"/templates/spam-whatsapp",bundlePath:"",filename:""},components:{App:d.default,Document:o()},userland:c});a()}catch(e){a(e)}})},86697:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{default:()=>h});var r=s(20997),n=s(41649),l=s(11163),i=s(16689),o=s(41664),d=s.n(o),c=s(99648),m=s(37270),u=s(39322),x=e([c,m]);function p(){let{data:e,status:t}=(0,n.useSession)(),s=(0,l.useRouter)(),[a,o]=(0,i.useState)([]),[u,x]=(0,i.useState)(""),[p,h]=(0,i.useState)(null),[b,g]=(0,i.useState)(""),[j,f]=(0,i.useState)(""),[v,N]=(0,i.useState)(null),[z,y]=(0,i.useState)("none"),[S,w]=(0,i.useState)(3),[P,E]=(0,i.useState)(!1),[D,C]=(0,i.useState)({current:0,total:0}),[q,k]=(0,i.useState)(null),[I,_]=(0,i.useState)(null),F=async e=>{if(e.preventDefault(),!u){m.toast.error("Selecciona una instancia conectada");return}if(!p){m.toast.error("Sube un archivo Excel");return}E(!0);try{let e=new FormData;e.append("file",p),e.append("instanceId",u),e.append("message",b),"url"===z&&j?e.append("imageUrl",j):"upload"===z&&v&&e.append("imageFile",v),e.append("waitTime",S.toString());let t=await c.default.post("/api/templates/spam-whatsapp",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(e.total){let t=Math.round(100*e.loaded/e.total);console.log(`Upload progress: ${t}%`)}}}),s=t.data.spamId;k(s),C({current:0,total:t.data.totalContacts}),m.toast.success(`Enviando mensajes a ${t.data.totalContacts} contactos...`)}catch(e){console.error("Error:",e),m.toast.error(e.response?.data?.error||"Error al enviar mensajes"),E(!1),k(null)}},M=async()=>{if(q)try{await c.default.post("/api/templates/spam-control",{action:"stop",spamId:q}),m.toast.info("Deteniendo env\xedo...")}catch(e){console.error("Error stopping spam:",e),m.toast.error("Error al detener el env\xedo")}};return"loading"===t?r.jsx("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:r.jsx("div",{className:"text-white",children:"Cargando..."})}):(0,r.jsxs)("div",{className:"min-h-screen bg-zinc-950 text-white",children:[r.jsx("div",{className:"border-b border-zinc-800 bg-zinc-900/50 backdrop-blur-sm sticky top-0 z-10",children:r.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:r.jsx("div",{className:"flex items-center justify-between h-16",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx(d(),{href:"/templates",className:"text-emerald-500 hover:text-emerald-400 transition",children:"← Volver"}),r.jsx("h1",{className:"text-2xl font-bold",children:"\uD83D\uDCE8 SPAM WhatsApp"})]})})})}),r.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsxs)("form",{onSubmit:F,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-6",children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:"Selecciona tu instancia de WhatsApp"}),0===a.length?(0,r.jsxs)("div",{className:"text-zinc-400 text-sm",children:["No tienes instancias conectadas."," ",r.jsx(d(),{href:"/instances",className:"text-emerald-500 hover:underline",children:"Conecta una instancia"})]}):r.jsx("select",{value:u,onChange:e=>x(e.target.value),className:"w-full bg-zinc-800 border border-zinc-700 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500",children:a.map(e=>(0,r.jsxs)("option",{value:e.documentId,children:[e.name||"Instancia"," - ",e.phoneNumber||"Sin n\xfamero"]},e.documentId))})]}),(0,r.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-6",children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:"Sube tu archivo Excel"}),(0,r.jsxs)("p",{className:"text-zinc-400 text-sm mb-4",children:["El Excel debe tener una columna llamada ",r.jsx("code",{className:"bg-zinc-800 px-2 py-1 rounded",children:"numero"})]}),(0,r.jsxs)("div",{className:"border-2 border-dashed border-zinc-700 rounded-lg p-8 text-center hover:border-emerald-500 transition",children:[r.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0];t.name.endsWith(".xlsx")||t.name.endsWith(".xls")?h(t):m.toast.error("Por favor sube un archivo Excel (.xlsx o .xls)")}},className:"hidden",id:"excel-upload"}),(0,r.jsxs)("label",{htmlFor:"excel-upload",className:"cursor-pointer",children:[r.jsx("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCE"}),p?r.jsx("p",{className:"text-emerald-500",children:p.name}):r.jsx("p",{className:"text-zinc-400",children:"Click para subir o arrastra aqu\xed"})]})]})]}),(0,r.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-6",children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:"Mensaje (opcional)"}),r.jsx("textarea",{value:b,onChange:e=>g(e.target.value),placeholder:"Escribe tu mensaje aqu\xed...",rows:4,className:"w-full bg-zinc-800 border border-zinc-700 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),(0,r.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-6",children:[r.jsx("label",{className:"block text-sm font-medium mb-4",children:"Imagen (opcional)"}),(0,r.jsxs)("div",{className:"flex gap-4 mb-4",children:[r.jsx("button",{type:"button",onClick:()=>{y("none"),f(""),N(null)},className:`flex-1 py-2 px-4 rounded-md transition ${"none"===z?"bg-emerald-600 text-white":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"}`,children:"Sin imagen"}),r.jsx("button",{type:"button",onClick:()=>y("url"),className:`flex-1 py-2 px-4 rounded-md transition ${"url"===z?"bg-emerald-600 text-white":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"}`,children:"URL"}),r.jsx("button",{type:"button",onClick:()=>y("upload"),className:`flex-1 py-2 px-4 rounded-md transition ${"upload"===z?"bg-emerald-600 text-white":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"}`,children:"Subir archivo"})]}),"url"===z&&r.jsx("div",{children:r.jsx("input",{type:"url",value:j,onChange:e=>f(e.target.value),placeholder:"https://ejemplo.com/imagen.png",className:"w-full bg-zinc-800 border border-zinc-700 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500"})}),"upload"===z&&(0,r.jsxs)("div",{className:"border-2 border-dashed border-zinc-700 rounded-lg p-6 text-center hover:border-emerald-500 transition",children:[r.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",onChange:e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0];["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(t.type)?t.size<=5242880?(N(t),f("")):m.toast.error("La imagen debe ser menor a 5MB"):m.toast.error("Formato de imagen no v\xe1lido. Usa JPG, PNG, GIF o WebP")}},className:"hidden",id:"image-upload"}),(0,r.jsxs)("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[r.jsx("div",{className:"text-4xl mb-2",children:"\uD83D\uDDBC️"}),v?(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-emerald-500 mb-1",children:v.name}),(0,r.jsxs)("p",{className:"text-zinc-400 text-xs",children:[(v.size/1024).toFixed(2)," KB"]})]}):(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-zinc-400",children:"Click para subir o arrastra aqu\xed"}),r.jsx("p",{className:"text-zinc-500 text-xs mt-1",children:"JPG, PNG, GIF, WebP (m\xe1x. 5MB)"})]})]})]})]}),(0,r.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"⚙️ Configuraci\xf3n Avanzada"}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:"Espera entre mensajes (segundos)"}),r.jsx("input",{type:"number",min:"1",max:"60",value:S,onChange:e=>w(parseInt(e.target.value)),className:"w-full bg-zinc-800 border border-zinc-700 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500"}),r.jsx("p",{className:"text-zinc-400 text-xs mt-1",children:"Recomendado: 3-5 segundos para evitar bloqueos"})]})]}),r.jsx("div",{className:"flex gap-4",children:P?r.jsx("button",{type:"button",onClick:M,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 px-6 rounded-md transition font-bold flex items-center justify-center gap-2",children:"\uD83D\uDED1 DETENER ENV\xcdO"}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{type:"button",onClick:()=>s.push("/templates"),className:"flex-1 bg-zinc-800 hover:bg-zinc-700 text-white py-3 px-6 rounded-md transition",children:"Cancelar"}),r.jsx("button",{type:"submit",disabled:P||!p||0===a.length,className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-3 px-6 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed",children:"Iniciar Env\xedo \uD83D\uDE80"})]})}),P&&D.total>0&&(0,r.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between mb-2",children:[r.jsx("span",{className:"font-semibold",children:"Progreso del Env\xedo"}),(0,r.jsxs)("span",{className:"font-mono",children:[D.current," / ",D.total]})]}),r.jsx("div",{className:"w-full bg-zinc-800 rounded-full h-4 mb-4 overflow-hidden",children:(0,r.jsxs)("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-600 h-4 rounded-full transition-all duration-500 flex items-center justify-center text-xs text-white font-bold",style:{width:`${D.total>0?D.current/D.total*100:0}%`},children:[D.total>0&&Math.round(D.current/D.total*100),"%"]})}),I&&(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,r.jsxs)("div",{className:"bg-zinc-800 p-3 rounded",children:[r.jsx("div",{className:"text-2xl font-bold text-emerald-500",children:I.success.length}),r.jsx("div",{className:"text-xs text-zinc-400",children:"Exitosos"})]}),(0,r.jsxs)("div",{className:"bg-zinc-800 p-3 rounded",children:[r.jsx("div",{className:"text-2xl font-bold text-red-500",children:I.errors.length}),r.jsx("div",{className:"text-xs text-zinc-400",children:"Errores"})]}),(0,r.jsxs)("div",{className:"bg-zinc-800 p-3 rounded",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-500",children:D.total-D.current}),r.jsx("div",{className:"text-xs text-zinc-400",children:"Pendientes"})]})]}),r.jsx("div",{className:"mt-4 text-center",children:r.jsx("p",{className:"text-zinc-400 text-sm",children:I?.stopped?"\uD83D\uDED1 Env\xedo detenido por el usuario":I?.completed?"✅ Env\xedo completado":"⏳ Enviando mensajes..."})})]})]})})]})}function h(){return(0,r.jsxs)(u.default,{children:[r.jsx(p,{}),r.jsx(m.Toaster,{position:"top-right"})]})}[c,m]=x.then?(await x)():x,a()}catch(e){a(e)}})},41649:e=>{e.exports=require("next-auth/react")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},62785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},16689:e=>{e.exports=require("react")},66405:e=>{e.exports=require("react-dom")},20997:e=>{e.exports=require("react/jsx-runtime")},99648:e=>{e.exports=import("axios")},37270:e=>{e.exports=import("sonner")},57147:e=>{e.exports=require("fs")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},59796:e=>{e.exports=require("zlib")}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[682,830,675,663,773],()=>s(79758));module.exports=a})();