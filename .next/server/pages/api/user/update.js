"use strict";(()=>{var e={};e.id=635,e.ids=[635],e.modules={92885:e=>{e.exports=require("@supabase/supabase-js")},62113:e=>{e.exports=require("next-auth/next")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},56249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},27666:(e,r,t)=>{t.r(r),t.d(r,{config:()=>p,default:()=>c,routeModule:()=>m});var a={};t.r(a),t.d(a,{default:()=>d});var s=t(71802),i=t(47153),n=t(56249),o=t(92618),u=t(62113),l=t(15512);async function d(e,r){if("POST"!==e.method)return r.status(405).json({error:"M\xe9todo no permitido"});let{username:t,key:a}=e.body;if(!t||!a)return r.status(400).json({error:"Faltan datos necesarios"});try{let s=await (0,u.getServerSession)(e,r,l.authOptions);if(!s||!s.id)return r.status(401).json({error:"No autorizado - Inicia sesi\xf3n"});let{error:i}=await o.p.auth.admin.updateUserById(s.id,{user_metadata:{username:t}});if(i)return console.error("Error updating auth metadata:",i),r.status(500).json({error:"Error al actualizar usuario"});let{error:n}=await o.p.from("profiles").update({api_key:a}).eq("id",s.id);if(n)return console.error("Error updating profile:",n),r.status(500).json({error:"Error al actualizar perfil"});return r.status(200).json({success:!0,message:"Usuario actualizado correctamente"})}catch(e){return console.error("Error al actualizar la info del usuario:",e.message),r.status(500).json({error:"Error interno al actualizar usuario"})}}let c=(0,n.l)(a,"default"),p=(0,n.l)(a,"config"),m=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/user/update",pathname:"/api/user/update",bundlePath:"",filename:""},userland:a})},15512:(e,r,t)=>{t.r(r),t.d(r,{authOptions:()=>c,default:()=>p});let a=require("next-auth");var s=t.n(a);let i=require("next-auth/providers/credentials");var n=t.n(i);let o=(0,t(92885).createClient)("https://blxk-supabase.1mrj9n.easypanel.host","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE");async function u({email:e,password:r}){let{data:t,error:a}=await o.auth.signInWithPassword({email:e,password:r});if(a)throw Error(a.message||"Error al iniciar sesi\xf3n");let{data:s}=await o.from("profiles").select("username").eq("id",t.user?.id).single();return{jwt:t.session?.access_token||"",user:{id:t.user?.id||"",email:t.user?.email||"",username:s?.username||t.user?.email?.split("@")[0]||""}}}let l=require("next-auth/providers/google");var d=t.n(l);let c={providers:[n()({name:"Sign in with Email",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(!e)return null;try{let{user:r,jwt:t}=await u({email:e.email,password:e.password});return{id:r.id,jwt:t,username:r.username,email:r.email}}catch(e){return null}}}),d()({clientId:process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID,clientSecret:process.env.NEXT_PUBLIC_GOOGLE_CLIENT_SECRET,authorization:{params:{prompt:"consent",access_type:"offline",response_type:"code"}}})],session:{strategy:"jwt",maxAge:259200},pages:{signIn:"/login"},callbacks:{jwt:async({token:e,user:r,account:t,profile:a})=>(r&&(e.jwt=r.jwt,e.id=r.id,e.email=r.email,e.username=r.username),t?.provider==="google"&&a&&(e.email=a.email,e.name=a.name,e.picture=a.picture),e),redirect:async({url:e,baseUrl:r})=>e===r||e===`${r}/login`?`${r}/`:e.startsWith(r)?e:r,session:async({session:e,token:r})=>(r&&(e.id=r.id,e.jwt=r.jwt,e.email=r.email,e.username=r.username),e)}},p=s()(c)},92618:(e,r,t)=>{t.d(r,{p:()=>a});let a=(0,t(92885).createClient)("https://blxk-supabase.1mrj9n.easypanel.host",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})},47153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},71802:(e,r,t)=>{e.exports=t(20145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=27666);module.exports=t})();