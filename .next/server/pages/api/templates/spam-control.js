"use strict";(()=>{var e={};e.id=466,e.ids=[466],e.modules={92885:e=>{e.exports=require("@supabase/supabase-js")},62113:e=>{e.exports=require("next-auth/next")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},56249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},46195:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>d,routeModule:()=>m});var s={};r.r(s),r.d(s,{default:()=>c});var n=r(71802),i=r(47153),o=r(56249),a=r(62113),u=r(15512),l=r(73849);async function c(e,t){try{let r=await (0,a.getServerSession)(e,t,u.authOptions);if(!r||!r.id)return t.status(401).json({error:"No autorizado"});let{method:s}=e;if("GET"===s){let{spamId:s}=e.query;if(s){let e=(0,l.b5)(s);if(!e)return t.status(404).json({error:"Env\xedo no encontrado"});if(e.userId!==r.id)return t.status(403).json({error:"No autorizado"});return t.json({status:e})}{let e=(0,l.JE)(r.id);return t.json({spams:e})}}if("POST"===s){let{action:s,spamId:n}=e.body;if(!n)return t.status(400).json({error:"spamId es requerido"});let i=(0,l.b5)(n);if(!i)return t.status(404).json({error:"Env\xedo no encontrado"});if(i.userId!==r.id)return t.status(403).json({error:"No autorizado"});if("stop"===s)return(0,l.cl)(n),t.json({success:!0,message:"Env\xedo detenido",status:(0,l.b5)(n)});if("cleanup"===s)return(0,l.Co)(n),t.json({success:!0,message:"Env\xedo limpiado"});return t.status(400).json({error:"Acci\xf3n no v\xe1lida"})}if("DELETE"===s){let{spamId:s}=e.query;if(!s)return t.status(400).json({error:"spamId es requerido"});let n=(0,l.b5)(s);if(n&&n.userId!==r.id)return t.status(403).json({error:"No autorizado"});return(0,l.Co)(s),t.json({success:!0})}return t.status(405).json({error:"M\xe9todo no permitido"})}catch(e){console.error("Error in spam-control:",e),t.status(500).json({error:e.message})}}let d=(0,o.l)(s,"default"),p=(0,o.l)(s,"config"),m=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/templates/spam-control",pathname:"/api/templates/spam-control",bundlePath:"",filename:""},userland:s})},15512:(e,t,r)=>{r.r(t),r.d(t,{authOptions:()=>d,default:()=>p});let s=require("next-auth");var n=r.n(s);let i=require("next-auth/providers/credentials");var o=r.n(i);let a=(0,r(92885).createClient)("https://blxk-supabase.1mrj9n.easypanel.host","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE");async function u({email:e,password:t}){let{data:r,error:s}=await a.auth.signInWithPassword({email:e,password:t});if(s)throw Error(s.message||"Error al iniciar sesi\xf3n");let{data:n}=await a.from("profiles").select("username").eq("id",r.user?.id).single();return{jwt:r.session?.access_token||"",user:{id:r.user?.id||"",email:r.user?.email||"",username:n?.username||r.user?.email?.split("@")[0]||""}}}let l=require("next-auth/providers/google");var c=r.n(l);let d={providers:[o()({name:"Sign in with Email",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(!e)return null;try{let{user:t,jwt:r}=await u({email:e.email,password:e.password});return{id:t.id,jwt:r,username:t.username,email:t.email}}catch(e){return null}}}),c()({clientId:process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID,clientSecret:process.env.NEXT_PUBLIC_GOOGLE_CLIENT_SECRET,authorization:{params:{prompt:"consent",access_type:"offline",response_type:"code"}}})],session:{strategy:"jwt",maxAge:259200},pages:{signIn:"/login"},callbacks:{jwt:async({token:e,user:t,account:r,profile:s})=>(t&&(e.jwt=t.jwt,e.id=t.id,e.email=t.email,e.username=t.username),r?.provider==="google"&&s&&(e.email=s.email,e.name=s.name,e.picture=s.picture),e),redirect:async({url:e,baseUrl:t})=>e===t||e===`${t}/login`?`${t}/`:e.startsWith(t)?e:t,session:async({session:e,token:t})=>(t&&(e.id=t.id,e.jwt=t.jwt,e.email=t.email,e.username=t.username),e)}},p=n()(d)},73849:(e,t,r)=>{r.d(t,{Co:()=>d,Hd:()=>u,JE:()=>c,RO:()=>a,b5:()=>l,bL:()=>i,cl:()=>o,jg:()=>n});let s=new Map;function n(e,t,r){return s.set(e,{id:e,userId:r,totalContacts:t,currentContact:0,stopped:!1,completed:!1,startedAt:new Date,errors:[],success:[]}),s.get(e)}function i(e){let t=s.get(e);return!!t&&!t.stopped&&!t.completed}function o(e){let t=s.get(e);t&&(t.stopped=!0,t.stoppedAt=new Date)}function a(e,t,r=null){let n=s.get(e);n&&(n.currentContact=t,n.lastUpdate=new Date,r&&(r.success?n.success.push(r.number):n.errors.push({number:r.number,error:r.error})))}function u(e){let t=s.get(e);t&&(t.completed=!0,t.completedAt=new Date,setTimeout(()=>{s.delete(e)},3e5))}function l(e){return s.get(e)||null}function c(e){let t=[];for(let[r,n]of s.entries())n.userId===e&&t.push(n);return t}function d(e){return!!s.get(e)&&(s.delete(e),!0)}},47153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=46195);module.exports=r})();