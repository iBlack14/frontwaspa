"use strict";(()=>{var e={};e.id=165,e.ids=[165],e.modules={92885:e=>{e.exports=require("@supabase/supabase-js")},62113:e=>{e.exports=require("next-auth/next")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},99648:e=>{e.exports=import("axios")},56249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},86150:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>l,routeModule:()=>d});var a=r(71802),i=r(47153),n=r(56249),o=r(29449),u=e([o]);o=(u.then?(await u)():u)[0];let l=(0,n.l)(o,"default"),c=(0,n.l)(o,"config"),d=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/suite",pathname:"/api/suite",bundlePath:"",filename:""},userland:o});s()}catch(e){s(e)}})},15512:(e,t,r)=>{r.r(t),r.d(t,{authOptions:()=>d,default:()=>p});let s=require("next-auth");var a=r.n(s);let i=require("next-auth/providers/credentials");var n=r.n(i);let o=(0,r(92885).createClient)("https://blxk-supabase.1mrj9n.easypanel.host","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE");async function u({email:e,password:t}){let{data:r,error:s}=await o.auth.signInWithPassword({email:e,password:t});if(s)throw Error(s.message||"Error al iniciar sesi\xf3n");let{data:a}=await o.from("profiles").select("username").eq("id",r.user?.id).single();return{jwt:r.session?.access_token||"",user:{id:r.user?.id||"",email:r.user?.email||"",username:a?.username||r.user?.email?.split("@")[0]||""}}}let l=require("next-auth/providers/google");var c=r.n(l);let d={providers:[n()({name:"Sign in with Email",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(!e)return null;try{let{user:t,jwt:r}=await u({email:e.email,password:e.password});return{id:t.id,jwt:r,username:t.username,email:t.email}}catch(e){return null}}}),c()({clientId:process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID,clientSecret:process.env.NEXT_PUBLIC_GOOGLE_CLIENT_SECRET,authorization:{params:{prompt:"consent",access_type:"offline",response_type:"code"}}})],session:{strategy:"jwt",maxAge:259200},pages:{signIn:"/login"},callbacks:{jwt:async({token:e,user:t,account:r,profile:s})=>(t&&(e.jwt=t.jwt,e.id=t.id,e.email=t.email,e.username=t.username),r?.provider==="google"&&s&&(e.email=s.email,e.name=s.name,e.picture=s.picture),e),redirect:async({url:e,baseUrl:t})=>e===t||e===`${t}/login`?`${t}/`:e.startsWith(t)?e:t,session:async({session:e,token:t})=>(t&&(e.id=t.id,e.jwt=t.jwt,e.email=t.email,e.username=t.username),e)}},p=a()(d)},29449:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>l});var a=r(92618),i=r(62113),n=r(15512),o=r(99648),u=e([o]);async function l(e,t){let{method:r,body:s}=e;try{let o=await (0,i.getServerSession)(e,t,n.authOptions);if(!o||!o.id)return t.status(401).json({error:"No autorizado"});if("GET"===r){let{data:e,error:r}=await a.p.from("suites").select("*").eq("user_id",o.id).order("created_at",{ascending:!1});if(r)return console.error("Error fetching suites:",r),t.status(500).json({error:r.message});return t.status(200).json([{suites:e||[]}])}if("POST"===r){let{service_name:e,service_url:r,product_name:i}=s;if(!e)return t.status(400).json({error:"Falta service_name"});let{data:n}=await a.p.from("suites").select("id").eq("user_id",o.id).eq("name",e).single();if(n)return t.status(400).json({error:"Ya existe una instancia con ese nombre"});let u=process.env.EASYPANEL_BASE_DOMAIN||"1mrj9n.easypanel.host",l=r||`https://${e}.${u}`,{data:c,error:d}=await a.p.from("suites").insert({user_id:o.id,name:e,url:l,activo:!1,credencials:{product:i||"N8N",created_by:o.email||o.user?.email,mode:"development",note:"Instancia en modo desarrollo - contenedor Docker no creado a\xfan"}}).select().single();if(d)return console.error("Error creating suite:",d),t.status(500).json({error:d.message});return t.status(201).json({success:!0,message:"Instancia creada exitosamente",suite:c})}return t.status(405).json({error:"Method not allowed"})}catch(e){return console.error("API error:",e),t.status(500).json({error:e.message||"Internal Server Error"})}}o=(u.then?(await u)():u)[0],s()}catch(e){s(e)}})},92618:(e,t,r)=>{r.d(t,{p:()=>s});let s=(0,r(92885).createClient)("https://blxk-supabase.1mrj9n.easypanel.host",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})},47153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=86150);module.exports=r})();