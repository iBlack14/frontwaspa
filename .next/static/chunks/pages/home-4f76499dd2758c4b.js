(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[229],{7183:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/home",function(){return n(2445)}])},2445:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var a=n(5893),s=n(3299),r=n(7294),l=n(7066),o=n(9332),i=n(4139),c=n(4712);let d=r.forwardRef(function(e,t){let{title:n,titleId:a,...s}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},s),n?r.createElement("title",{id:a},n):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}),u=(0,r.lazy)(()=>Promise.all([n.e(196),n.e(92),n.e(654)]).then(n.bind(n,5654)));function m(){let{data:e,status:t}=(0,s.useSession)(),n=(0,o.useRouter)(),[i,m]=(0,r.useState)([]),[h,f]=(0,r.useState)(null),[g,p]=(0,r.useState)([]),[b,x]=(0,r.useState)({}),[v,j]=(0,r.useState)(!0),[w,_]=(0,r.useState)(!1),N=(0,r.useRef)(null);(0,r.useEffect)(()=>{"unauthenticated"===t?n.push("/login"):"authenticated"===t&&y()},[t,n]),(0,r.useEffect)(()=>{let e=e=>{N.current&&!N.current.contains(e.target)&&_(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let y=async()=>{j(!0);try{let e=await l.Z.get("/api/instances");console.log(e.data);let t=e.data.instances.map(e=>({id:e.id,documentId:e.document_id||e.documentId,webhook_url:e.webhook_url||null,state:e.state,is_active:e.is_active,historycal_data:e.historycal_data||[]}));m(t);let n=t.filter(e=>"Connected"===e.state&&e.documentId);await Promise.all(n.map(e=>C(e.documentId))),t.length>0&&(f(t[0].documentId),p(t[0].historycal_data||[]))}catch(e){console.error("Error fetching user sessions:",e),c.Am.error("Failed to fetch instances. Please try again.")}finally{j(!1)}},C=async e=>{if(!e){console.warn("fetchProfileData called with undefined documentId");return}if(!b[e])try{let t=await l.Z.get("/api/instances/profile/".concat(e),{headers:{"Content-Type":"application/json"},timeout:5e3});x(n=>({...n,[e]:{name:t.data.name,profilePicUrl:t.data.profilePicUrl,number:t.data.number}}))}catch(n){var t;console.error("Error fetching profile for ".concat(e,":"),(null===(t=n.response)||void 0===t?void 0:t.data)||n.message),x(t=>({...t,[e]:{name:" ",profilePicUrl:" ",number:" "}}))}},k=e=>{f(e);let t=i.find(t=>t.documentId===e);p((null==t?void 0:t.historycal_data)||[]),_(!1)},P=i.find(e=>e.documentId===h),E=P?b[P.documentId]:null,I={labels:g.map(e=>e.date),datasets:[{label:"Messages Sent",data:g.map(e=>e.message_sent),borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",tension:.4},{label:"API Messages Sent",data:g.map(e=>e.api_message_sent),borderColor:"rgba(153, 102, 255, 1)",backgroundColor:"rgba(153, 102, 255, 0.2)",tension:.4},{label:"Messages Received",data:g.map(e=>e.message_received),borderColor:"rgba(255, 159, 64, 1)",backgroundColor:"rgba(255, 159, 64, 0.2)",tension:.4}]},z={responsive:!0,maintainAspectRatio:!0,aspectRatio:2,interaction:{mode:"nearest",intersect:!0},plugins:{legend:{position:"top"},title:{display:!0,text:"Historical Data"},tooltip:{enabled:!0,callbacks:{label:e=>{let t=e.dataset.label||"",n=e.parsed.y;return"".concat(t,": ").concat(n)}}},datalabels:{display:!0,align:"top",formatter:e=>"".concat(e),color:"#ffff",font:{weight:"bold",size:12}}},scales:{x:{min:0,max:g.length>0?g.length-1:0},y:{min:0,max:g.length>0?1.2*Math.max(...g.flatMap(e=>[e.message_sent,e.api_message_sent,e.message_received])):100}}};return(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)(c.x7,{richColors:!0,position:"top-right"}),v?(0,a.jsx)("p",{className:"text-zinc-400",children:"Loading instances..."}):0===i.length?(0,a.jsx)("p",{className:"text-zinc-400",children:"No instances available. Please create a new instance."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"text-white mb-2 block",children:"Select Instance:"}),(0,a.jsxs)("div",{className:"relative",ref:N,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-zinc-800 border border-zinc-700 rounded-lg cursor-pointer hover:bg-zinc-700 transition",onClick:()=>_(!w),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(null==P?void 0:P.state)==="Connected"&&(null==E?void 0:E.profilePicUrl)&&(0,a.jsx)("img",{src:E.profilePicUrl,alt:"Profile",className:"w-8 h-8 rounded-full object-cover border-2 border-green-500",onError:e=>e.currentTarget.src="/logo/profile.png"}),(0,a.jsxs)("span",{className:"text-white",children:[(null==P?void 0:P.documentId)||"Select an instance"," ",(null==P?void 0:P.state)==="Connected"&&(null==E?void 0:E.name)?"(".concat(E.name," - ").concat(E.number,")"):""]})]}),(0,a.jsx)(d,{className:"w-5 h-5 text-white transition-transform ".concat(w?"rotate-180":"")})]}),w&&(0,a.jsx)("div",{className:"absolute z-10 mt-2 w-full bg-zinc-800 border border-zinc-700 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:i.map(e=>{let t=b[e.documentId];return(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 hover:bg-zinc-700 cursor-pointer transition",onClick:()=>k(e.documentId),children:["Connected"===e.state&&(null==t?void 0:t.profilePicUrl)&&(0,a.jsx)("img",{src:t.profilePicUrl,alt:"Profile",className:"w-8 h-8 rounded-full object-cover border-2 border-green-500",onError:e=>e.currentTarget.src="/logo/profile.png"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-white",children:e.documentId}),"Connected"===e.state&&(null==t?void 0:t.name)&&(0,a.jsxs)("span",{className:"text-zinc-400 text-sm block",children:[t.name," - ",t.number]})]}),(0,a.jsx)("span",{className:"ml-auto text-xs px-2 py-1 rounded-full ".concat("Connected"===e.state?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.state})]},e.documentId)})})]})]}),g.length>0?(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"flex items-center justify-center h-[500px]",children:(0,a.jsx)("div",{className:"text-zinc-400",children:"Cargando gr\xe1fico..."})}),children:(0,a.jsx)(u,{data:I,options:z})}):(0,a.jsx)("p",{className:"text-zinc-400",children:"No historical data available for this instance."})]})]})}function h(){return(0,a.jsx)(i.default,{children:(0,a.jsx)(m,{})})}}},function(e){e.O(0,[141,675,261,712,139,888,774,179],function(){return e(e.s=7183)}),_N_E=e.O()}]);