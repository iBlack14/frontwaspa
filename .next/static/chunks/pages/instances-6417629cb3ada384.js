(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[562],{9126:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/instances",function(){return t(8944)}])},1154:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return r}});var a=t(5893),n=t(5675),i=t.n(n);function r(){return(0,a.jsxs)("div",{className:"bg-zinc-900 px-8 hidden xl:block py-9 rounded-lg shadow-lg max-w-3xl mx-auto mt-10",children:[(0,a.jsx)("h2",{className:"text-xl font-bold px-2 text-white mb-4 flex items-center gap-2",children:"\xbfC\xf3mo escanear el QR de WhatsApp?"}),(0,a.jsx)(i(),{src:"/logo/helpme.png",alt:"Logo",width:400,height:400,className:"hidden lg:block w-1/2 h-auto mx-auto mt-10",style:{maxWidth:"400px"}}),(0,a.jsx)("div",{className:"mt-8 max-w-md mx-auto",children:(0,a.jsxs)("ol",{className:"space-y-4 text-zinc-200",children:[(0,a.jsxs)("li",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"flex-shrink-0 mt-1",children:(0,a.jsxs)("svg",{className:"w-6 h-6 text-emerald-400",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:[(0,a.jsx)("rect",{x:"4",y:"2",width:"16",height:"20",rx:"3",stroke:"currentColor",strokeWidth:"2",fill:"none"}),(0,a.jsx)("circle",{cx:"12",cy:"18",r:"1",fill:"currentColor"})]})}),(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"font-semibold text-emerald-400",children:"Paso 1:"})," Abre WhatsApp en tu tel\xe9fono."]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"flex-shrink-0 mt-1",children:(0,a.jsxs)("svg",{className:"w-6 h-6 text-emerald-400",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:[(0,a.jsx)("rect",{x:"4",y:"2",width:"16",height:"20",rx:"3",stroke:"currentColor",strokeWidth:"2",fill:"none"}),(0,a.jsx)("circle",{cx:"12",cy:"18",r:"1",fill:"currentColor"})]})}),(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"font-semibold text-emerald-400",children:"Paso 2:"})," Ve a ",(0,a.jsxs)("span",{className:"font-semibold",children:["Ajustes ",">"," Dispositivos vinculados"]}),"."]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"flex-shrink-0 mt-1",children:(0,a.jsxs)("svg",{className:"w-6 h-6 text-emerald-400",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:[(0,a.jsx)("rect",{x:"4",y:"2",width:"16",height:"20",rx:"3",stroke:"currentColor",strokeWidth:"2",fill:"none"}),(0,a.jsx)("circle",{cx:"12",cy:"18",r:"1",fill:"currentColor"})]})}),(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"font-semibold text-emerald-400",children:"Paso 3:"})," Pulsa en ",(0,a.jsx)("span",{className:"font-semibold",children:"Vincular un dispositivo"})," y escanea el c\xf3digo QR que aparece en la pantalla."]})]})]})})]})}},8944:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return w}});var a=t(5893),n=t(3299),i=t(7294),r=t(7066),c=t(9332),l=t(4139),o=t(1154),d=t(5675),m=t.n(d),x=t(929),u=t(245),h=t(2188),p=t(6136),g=t(5357),v=t(1950),j=t(4216),f=t(4712),b=t(6976);function N(){var e;let{data:s,status:t}=(0,n.useSession)(),l=null===(e=(0,n.useSession)().data)||void 0===e?void 0:e.username,[d,N]=(0,i.useState)(!1),[w,y]=(0,i.useState)(null),k=(0,c.useRouter)(),[_,C]=(0,i.useState)([]),[z,I]=(0,i.useState)({}),[E,A]=(0,i.useState)({}),[W,P]=(0,i.useState)({message_received:!1,message_sent:!1}),Z=async(e,s)=>{let t=await fetch(e,{headers:{Authorization:"Bearer ".concat(s)}});if(!t.ok)throw console.error("Error en respuesta: ".concat(t.status," ").concat(t.statusText)),Error("Error API: ".concat(t.status));return(await t.json()).instances.map(e=>({id:e.id,documentId:e.document_id||e.documentId,webhook_url:e.webhook_url||null,state:e.state,is_active:e.is_active,message_received:e.message_received||!1,message_sent:e.message_sent||!1,qr:e.qr||null,qr_loading:e.qr_loading||!1,name:e.profile_name||null,profilePicUrl:e.profile_pic_url||null,phoneNumber:e.phone_number||null}))},{data:q,error:R,isLoading:S}=(0,b.ZP)((null==s?void 0:s.id)?"/api/instances?token=".concat(s.jwt):null,e=>Z(e,""),{refreshInterval:5e3});(0,i.useEffect)(()=>{q&&(C(q),I(q.reduce((e,s)=>({...e,[s.documentId]:s.webhook_url||""}),{})))},[q]),(0,i.useEffect)(()=>{"unauthenticated"===t&&k.push("/login")},[t,k]);let T=async e=>{if(!_.find(s=>("Disconnected"===s.state||"Initializing"===s.state)&&s.documentId===e)){console.warn("No disconnected or initializing session found for documentId: ".concat(e));return}try{await r.Z.post("/api/instances/qr",{clientId:e},{headers:{"Content-Type":"application/json",token:null==s?void 0:s.jwt}})}catch(s){var t,a;f.Am.error((null===(a=s.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Error fetching QR for ".concat(e,":"))}},Q=async()=>{try{await r.Z.post("/api/instances"),f.Am.success("Nueva instancia creada con \xe9xito")}catch(i){var e,s,t,a,n;console.error("Error al crear nueva instancia:",(null===(e=i.response)||void 0===e?void 0:e.data)||i.message),f.Am.error((null===(t=i.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||(null===(n=i.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.error)||"Error al crear nueva instancia")}},B=async e=>{try{let s=z[e];await r.Z.put("/api/instances/webhook?documentId=".concat(e),{webhook_url:s},{headers:{"Content-Type":"application/json"}}),f.Am.success("Webhook actualizado con \xe9xito")}catch(e){var s,t;f.Am.error((null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.error)||"Error al actualizar el webhook")}},D=(e,s)=>{I(t=>({...t,[e]:s}))},G=async(e,s)=>{try{let t=!s;await r.Z.put("/api/instances?documentId=".concat(e),{data:{is_active:t}},{headers:{"Content-Type":"application/json"}}),f.Am.success("Instancia ".concat(t?"activada":"pausada"," con \xe9xito"))}catch(e){var t,a;f.Am.error((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Error al alternar estado de la instancia:")}},U=async e=>{try{await r.Z.post("/api/instances/disconnect/".concat(e),{},{headers:{"Content-Type":"application/json"}}),f.Am.success("Sesi\xf3n desconectada con \xe9xito")}catch(e){var s;console.error("Error al desconectar la instancia:",(null===(s=e.response)||void 0===s?void 0:s.data)||e.message),f.Am.error("Error al desconectar la instancia")}},V=async e=>{let s=_.find(s=>s.documentId===e);s&&(P({message_received:s.message_received||!1,message_sent:s.message_sent||!1}),y(e),N(!0))},F=async()=>{if(w)try{await r.Z.put("/api/instances?documentId=".concat(w),{data:{message_received:W.message_received,message_sent:W.message_sent}},{headers:{"Content-Type":"application/json"}}),f.Am.success("Configuraci\xf3n de webhook actualizada con \xe9xito"),N(!1)}catch(t){var e,s;f.Am.error((null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Error al actualizar configuraci\xf3n de webhook")}};return(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)(f.x7,{richColors:!0,position:"top-right"}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsxs)("div",{className:"p-5 w-7xl mx-auto",children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-white mb-6",children:["Bienvenido, ",l]}),(0,a.jsxs)("div",{className:"mb-5",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Tus Sesiones ❤️❤️"}),0===_.length?(0,a.jsxs)("button",{onClick:Q,className:"flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-md hover:bg-emerald-700 transition",children:[(0,a.jsx)(x.Z,{className:"w-5 h-5"}),"Activa tu Prueba gratuita por 7 d\xedas aqu\xed"]}):(0,a.jsxs)("button",{onClick:Q,className:"flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-md hover:bg-emerald-700 transition",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5"}),"Nueva Instancia"]})]}),R&&(0,a.jsx)("p",{className:"text-red-500 mb-4",children:R.message||"Error al cargar las sesiones."}),S?(0,a.jsx)("p",{className:"text-zinc-400",children:"Cargando sesiones..."}):_.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-1 lg:grid-cols-2 gap-6",children:_.map(e=>{var s,t,n;return(0,a.jsxs)("div",{className:"bg-zinc-900/50 rounded-lg shadow-md shadow-emerald-800 p-3 border border-zinc-700",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("img",{src:e.profilePicUrl||(null===(s=E[e.documentId])||void 0===s?void 0:s.profilePicUrl)||"/logo/profile.png",alt:"Profile",className:"w-16 h-16 border-4 border-emerald-500 rounded-full object-cover shadow-lg",onError:e=>e.currentTarget.src="/logo/profile.png"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:e.name||(null===(t=E[e.documentId])||void 0===t?void 0:t.name)||"Instancia"}),(0,a.jsx)("p",{className:"text-sm text-zinc-400",children:e.phoneNumber||(null===(n=E[e.documentId])||void 0===n?void 0:n.number)||"N\xfamero no disponible"})]})]}),"                      ",(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat({Initializing:"bg-yellow-100 text-yellow-800",Connected:"bg-emerald-100 text-emerald-800",Failure:"bg-orange-100 text-orange-800",Disconnected:"bg-red-100 text-red-800"}[e.state]||"bg-gray-100 text-gray-800"),children:e.state}),"Connected"===e.state&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>G(e.documentId,e.is_active),className:"flex items-center justify-center w-8 h-8 rounded-full transition ".concat(e.is_active?"bg-emerald-600 hover:bg-emerald-700 text-white":"bg-gray-600 hover:bg-gray-700 text-white"),title:e.is_active?"Pausar instancia":"Activar instancia",children:e.is_active?(0,a.jsx)(h.Z,{className:"w-5 h-5"}):(0,a.jsx)(p.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:()=>U(e.documentId),className:"flex items-center justify-center w-8 h-8 rounded-full bg-red-600 hover:bg-red-700 text-white transition",title:"Desconectar instancia",children:(0,a.jsx)(g.Z,{className:"w-5 h-5"})})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("p",{className:"text-zinc-400",children:[(0,a.jsx)("span",{className:"font-bold",children:"ClientId:"})," ",e.documentId]}),"Connected"===e.state&&(0,a.jsx)("button",{onClick:()=>V(e.documentId),className:"flex items-center justify-center w-8 h-8 rounded-full bg-slate-600 hover:bg-slate-700 text-white transition",title:"Configura tu weebhook",children:(0,a.jsx)(v.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-zinc-400 font-medium block mb-1",children:"Webhook:"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:z[e.documentId]||"",onChange:s=>D(e.documentId,s.target.value),placeholder:"https://ejemplo.com/webhook",className:"p-2 w-full text-zinc-400 bg-zinc-900 border border-zinc-700 rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-500"}),(0,a.jsx)("button",{onClick:()=>B(e.documentId),className:"bg-emerald-600 text-white px-3 py-2 rounded-md hover:bg-emerald-700 transition",children:"Guardar"})]})]}),("Disconnected"===e.state||"Initializing"===e.state)&&(0,a.jsx)("div",{children:e.qr?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("label",{className:"text-zinc-400 font-medium block mb-1",children:"Escanea este QR:"}),(0,a.jsx)(m(),{width:400,height:400,src:e.qr,alt:"WhatsApp QR",className:"w-48 h-48 mx-auto",onError:e=>console.error("Error al cargar QR:",e)}),(0,a.jsx)("p",{className:"text-xs text-zinc-400 mt-2 text-center",children:"Escanea con WhatsApp / Ajustes / Dispositivos vinculados"})]}):e.qr_loading?(0,a.jsxs)("div",{className:"flex justify-center items-center",children:[(0,a.jsx)("span",{className:"text-zinc-400 text-sm",children:"Generando QR..."}),(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 ml-2 text-emerald-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]})]}):(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsx)("button",{onClick:async()=>{await T(e.documentId)},className:"bg-emerald-600 text-white px-3 py-2 rounded-md hover:bg-emerald-700 transition",children:"Genera un nuevo QR"})})})]})]},e.documentId)})}):(0,a.jsx)("p",{className:"text-zinc-400",children:"No tienes sesiones a\xfan. Crea una nueva instancia."})]})]}),(0,a.jsx)(o.default,{})]}),d&&(0,a.jsx)("div",{className:"fixed inset-0 bg-zinc/40 bg-opacity-50 shadow-md flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-zinc-900 border border-zinc-700 rounded-lg p-6 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Configurar Webhook"}),(0,a.jsx)("button",{onClick:()=>N(!1),className:"text-zinc-400 hover:text-white",children:(0,a.jsx)(j.Z,{className:"w-6 h-6"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:W.message_received,onChange:e=>P(s=>({...s,message_received:e.target.checked})),className:"mr-2"}),(0,a.jsx)("label",{className:"text-zinc-400",children:"Recibir mensajes (message_received)"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:W.message_sent,onChange:e=>P(s=>({...s,message_sent:e.target.checked})),className:"mr-2"}),(0,a.jsx)("label",{className:"text-zinc-400",children:"Mensajes enviados (message_sent)"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,a.jsx)("button",{onClick:()=>N(!1),className:"bg-zinc-600 text-white px-4 py-2 rounded-md hover:bg-zinc-700 transition",children:"Cancelar"}),(0,a.jsx)("button",{onClick:F,className:"bg-emerald-600 text-white px-4 py-2 rounded-md hover:bg-emerald-700 transition",children:"Guardar"})]})]})})]})}function w(){return(0,a.jsx)(l.default,{children:(0,a.jsx)(N,{})})}}},function(e){e.O(0,[141,675,261,712,262,139,888,774,179],function(){return e(e.s=9126)}),_N_E=e.O()}]);